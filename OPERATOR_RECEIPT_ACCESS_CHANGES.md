# –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ Operator –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞ –≤ –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏

**–î–∞—Ç–∞:** 23 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ

## üìã –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–†–æ–ª–∏ **Operator (–û–ø–µ—Ä–∞—Ç–æ—Ä –ü–ö)** –±—ã–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ **–ø—Ä–æ—Å–º–æ—Ç—Ä, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ **–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞**.

## üîÑ –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. **app/UserRole.php** (Enum —Ä–æ–ª–µ–π)

–î–æ–±–∞–≤–ª–µ–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ `'product_receipt'` –≤ —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è —Ä–æ–ª–∏ `Operator`:

```php
self::OPERATOR => [
    'products',
    'inventory',
    'products_in_transit',
    'product_receipt',  // ‚ú® –ù–æ–≤–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
],
```

**–†–∞–Ω–µ–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –¥–ª—è Operator:**
- ‚úÖ `products` (–¢–æ–≤–∞—Ä—ã)
- ‚úÖ `inventory` (–û—Å—Ç–∞—Ç–∫–∏)
- ‚úÖ `products_in_transit` (–¢–æ–≤–∞—Ä –≤ –ø—É—Ç–∏)

**–¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ `product_receipt` (–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)

---

### 2. **app/Filament/Resources/ReceiptResource.php** (–†–µ—Å—É—Ä—Å –ü—Ä–∏–µ–º–∫–∏)

#### canViewAny()
–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–æ–ª—å `'operator'` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–∞–∑–¥–µ–ª–∞:

```php
public static function canViewAny(): bool
{
    $user = Auth::user();
    if (! $user) {
        return false;
    }

    // –ü—Ä–∏–µ–º–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∞–¥–º–∏–Ω—É, –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –∏ —Ä–∞–±–æ—Ç–Ω–∏–∫—É —Å–∫–ª–∞–¥–∞
    return in_array($user->role->value, [
        'admin',
        'operator',        // ‚ú® –î–æ–±–∞–≤–ª–µ–Ω–æ
        'warehouse_worker',
    ]);
}
```

#### canEdit()
–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–æ–ª—å `'operator'` –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏:

```php
public static function canEdit($record): bool
{
    $user = Auth::user();
    if (! $user) {
        return false;
    }

    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –∞–¥–º–∏–Ω—É, –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –∏ —Ä–∞–±–æ—Ç–Ω–∏–∫—É —Å–∫–ª–∞–¥–∞
    return in_array($user->role->value, [
        'admin',
        'operator',        // ‚ú® –î–æ–±–∞–≤–ª–µ–Ω–æ
        'warehouse_worker',
    ]);
}
```

---

### 3. **app/Filament/Resources/ReceiptResource/Pages/EditReceipt.php** (–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–æ–ª—å `'operator'` –≤ –º–µ—Ç–æ–¥ `canEdit()`:

```php
public static function canEdit($record): bool
{
    $user = \Illuminate\Support\Facades\Auth::user();
    if (! $user) {
        return false;
    }

    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –∞–¥–º–∏–Ω—É, –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –∏ —Ä–∞–±–æ—Ç–Ω–∏–∫—É —Å–∫–ª–∞–¥–∞
    return in_array($user->role->value, [
        'admin',
        'operator',        // ‚ú® –î–æ–±–∞–≤–ª–µ–Ω–æ
        'warehouse_worker',
    ]);
}
```

---

### 4. **app/Policies/ProductPolicy.php** (–ü–æ–ª–∏—Ç–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

‚úÖ **–£–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Operator!**

–ü–æ–ª–∏—Ç–∏–∫–∞ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–∑—Ä–µ—à–∞–µ—Ç Operator —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–≤–∞—Ä—ã:

```php
public function create(User $user): bool
{
    return in_array($user->role, [
        UserRole::ADMIN,
        UserRole::OPERATOR,        // ‚úÖ –£–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
        UserRole::WAREHOUSE_WORKER,
        UserRole::SALES_MANAGER
    ]);
}

public function update(User $user, Product $product): bool
{
    if ($user->role === UserRole::ADMIN) {
        return true;
    }

    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –Ω–∞ —Å–≤–æ–µ–º —Å–∫–ª–∞–¥–µ
    return (int) $product->warehouse_id === (int) $user->warehouse_id;
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω—ã unit —Ç–µ—Å—Ç—ã –≤ —Ñ–∞–π–ª–µ `tests/Unit/OperatorReceiptAccessTest.php`:

```php
‚úì operator can view receipt resource          // –û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å
‚úì operator can edit receipt product            // –û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
‚úì operator has product receipt permission      // –û–ø–µ—Ä–∞—Ç–æ—Ä –∏–º–µ–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
‚úì admin can edit receipt product               // –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
‚úì warehouse worker can edit receipt product    // –†–∞–±–æ—Ç–Ω–∏–∫ —Å–∫–ª–∞–¥–∞ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

Tests: 5 passed (8 assertions)
```

**–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:**
```bash
php artisan test tests/Unit/OperatorReceiptAccessTest.php
```

---

## üìä –¢–∞–±–ª–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –†–∞–∑–¥–µ–ª: –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (ReceiptResource)

| –†–æ–ª—å | –ü—Ä–æ—Å–º–æ—Ç—Ä | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|------|----------|----------------|-----------|
| ‚úÖ Admin | –î–∞ | –î–∞ | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø |
| ‚úÖ Operator | **–î–∞** | **–î–∞** | **–ù–æ–≤–æ–µ!** |
| ‚úÖ Warehouse Worker | –î–∞ | –î–∞ | –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ—Å—Ç—É–ø |
| ‚ùå Sales Manager | –ù–µ—Ç | –ù–µ—Ç | –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ |

---

## üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è Operator

### –í —Ä–∞–∑–¥–µ–ª–µ –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:

1. **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ø—Ä–∏–µ–º–∫–µ** ‚úÖ
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–∫–ª–∞–¥—É
   - –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—é
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

2. **–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π —Ç–æ–≤–∞—Ä–∞** ‚úÖ
   - –í—Å–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –î–æ–∫—É–º–µ–Ω—Ç—ã
   - –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

3. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞** ‚úÖ
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
   - –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞** ‚úÖ
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –æ–±—ä–µ–º–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üîí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞

–°–ª–µ–¥—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ **–æ—Å—Ç–∞—é—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏** –¥–ª—è Operator:

- ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è Admin)
- ‚ùå –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è Admin)
- ‚ùå –ü—Ä–∏–Ω—è—Ç–∏–µ —Ç–æ–≤–∞—Ä–∞ (—á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å —Ç–æ–≤–∞—Ä" - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)

---

## üìù –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∫–ª–∞–¥–∞

Operator –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å–≤–æ–µ–≥–æ —Å–∫–ª–∞–¥–∞**:

```php
// –í ReceiptResource::getEloquentQuery()
if ($user->warehouse_id) {
    return $base->where('warehouse_id', $user->warehouse_id);
}
```

–ï—Å–ª–∏ Operator –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ –°–∫–ª–∞–¥ #1, –æ–Ω –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –°–∫–ª–∞–¥–∞ #1.

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ –±–æ–µ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ:

1. **–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   ```bash
   git pull origin main
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏** (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å):
   ```bash
   php artisan migrate
   ```

3. **–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
   ```bash
   php artisan config:cache
   php artisan route:cache
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```bash
   tail -f storage/logs/laravel.log
   ```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Filament Admin Panel

1. –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ Operator
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "–ü—Ä–∏–µ–º–∫–∞" ‚Üí "–ü—Ä–∏–µ–º–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤"
3. –ù–∞–∂–∞—Ç—å –Ω–∞ —Ç–æ–≤–∞—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–Ω–æ–ø–∫–∏ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ URL `/admin/receipts/{id}/edit`
5. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –ø–æ–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è API:

**Endpoint –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:**
```
PUT /api/products/{id}
```

**–¢—Ä–µ–±—É–µ–º—ã–µ –ø—Ä–∞–≤–∞:**
- Operator –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–≤–∞—Ä—ã —Å–≤–æ–µ–≥–æ —Å–∫–ª–∞–¥–∞
- Admin –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–≤–∞—Ä—ã –≤—Å–µ—Ö —Å–∫–ª–∞–¥–æ–≤

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

- ‚úÖ UserRole enum –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ ReceiptResource –æ–±–Ω–æ–≤–ª–µ–Ω (canViewAny + canEdit)
- ‚úÖ EditReceipt —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ ProductPolicy –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (—É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
- ‚úÖ Unit —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ö–æ–¥ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω (Pint)
- ‚úÖ –ö–æ–º–º–∏—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω
- ‚úÖ –ù–µ—Ç linter –æ—à–∏–±–æ–∫

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã.

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 23 –æ–∫—Ç—è–±—Ä—è 2025
