# –ú–µ—Ö–∞–Ω–∏–∑–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è calculated_volume

## üéØ –û–±—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å

`calculated_volume` —ç—Ç–æ –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–º —Ç–æ–≤–∞—Ä–∞ –∑–∞ –æ–¥–Ω—É –µ–¥–∏–Ω–∏—Ü—É, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º—ã–π –ø–æ —Ñ–æ—Ä–º—É–ª–µ, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –≤ —à–∞–±–ª–æ–Ω–µ —Ç–æ–≤–∞—Ä–∞ (ProductTemplate).

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:
- **ProductTemplate** - —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–æ—Ä–º—É–ª—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: "length * width * height")
- **ProductAttribute** - —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —à–∞–±–ª–æ–Ω–∞ (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º—É–ª–µ)
- **Product** - —Ç–æ–≤–∞—Ä —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ (–∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö) –∏ calculated_volume (—Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞)

---

## üìã –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å

### 1Ô∏è‚É£ –í–´ –í–´–ë–ò–†–ê–ï–¢–ï –®–ê–ë–õ–û–ù –¢–û–í–ê–†–ê
```
Form: Select -> product_template_id
–°–æ–±—ã—Ç–∏–µ: afterStateUpdated
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞—Ç—Ä–∏–±—É—Ç—ã –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞
- –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (attribute_X)
- `calculated_volume` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—ä–µ–º–∞"

**–ö–æ–¥:** ProductResource.php, —Å—Ç—Ä–æ–∫–∞ 123-135

---

### 2Ô∏è‚É£ –í–´ –ó–ê–ü–û–õ–ù–Ø–ï–¢–ï –ó–ù–ê–ß–ï–ù–ò–Ø –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö
```
Form: TextInput -> attribute_length, attribute_width, attribute_height (–∏ —Ç.–¥.)
–°–æ–±—ã—Ç–∏–µ: afterStateUpdated (–Ω–∞ –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–æ–±–∏—Ä–∞—é—Ç—Å—è –≤—Å–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ numeric —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
2. –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è quantity –≤ –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è —Ñ–æ—Ä–º—É–ª—ã
3. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è $template->testFormula($attributes)
4. –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ `calculated_volume`

**–§–æ—Ä–º—É–ª–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è:**
```php
// –°–æ–±–∏—Ä–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã —Å –≤–∞—à–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏
$attributes = [
    'length' => 10,      // –ß—Ç–æ –≤—ã –≤–≤–µ–ª–∏
    'width' => 5,        // –ß—Ç–æ –≤—ã –≤–≤–µ–ª–∏
    'height' => 2,       // –ß—Ç–æ –≤—ã –≤–≤–µ–ª–∏
    'quantity' => 100    // –ë–µ—Ä–µ—Ç—Å—è –∏–∑ –ø–æ–ª—è Quantity
];

// –ë–µ—Ä–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–∞ –∏–∑ ProductTemplate, –Ω–∞–ø—Ä–∏–º–µ—Ä: "length * width * height"
// –ü–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è: "10 * 5 * 2"
// –†–µ–∑—É–ª—å—Ç–∞—Ç = 100 (—ç—Ç–æ –æ–±—ä–µ–º –∑–∞ –æ–¥–Ω—É –µ–¥–∏–Ω–∏—Ü—É!)
```

**–ö–æ–¥:** ProductResource.php, —Å—Ç—Ä–æ–∫–∞ 268-332

---

### 3Ô∏è‚É£ –í–´ –ú–ï–ù–Ø–ï–¢–ï –ö–û–õ–ò–ß–ï–°–¢–í–û (QUANTITY)
```
Form: TextInput -> quantity
–°–æ–±—ã—Ç–∏–µ: afterStateUpdated
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è —Ñ–æ—Ä–º—É–ª—ã (–µ—Å–ª–∏ formula –µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç)
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `calculated_volume`

**–ö–æ–¥:** ProductResource.php, —Å—Ç—Ä–æ–∫–∞ 152-234

---

### 4Ô∏è‚É£ –í–´ –°–û–•–†–ê–ù–Ø–ï–¢–ï –§–û–†–ú–£ (–°–û–ó–î–ê–ù–ò–ï –¢–û–í–ê–†–ê)
```
CreateProduct::mutateFormDataBeforeCreate()
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–æ–±–∏—Ä–∞—é—Ç—Å—è –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã (attribute_X)
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç `$template->testFormula()`
3. –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `calculated_volume`
4. –¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ë–î

**–ö–æ–¥:** CreateProduct.php, —Å—Ç—Ä–æ–∫–∞ 59-129

---

### 5Ô∏è‚É£ –í–´ –†–ï–î–ê–ö–¢–ò–†–£–ï–¢–ï –¢–û–í–ê–† (–ò–ó–ú–ï–ù–ï–ù–ò–ï –¢–û–í–ê–†–ê)
```
EditProduct::mutateFormDataBeforeSave()
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –¢–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏, –Ω–æ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞

**–ö–æ–¥:** EditProduct.php, —Å—Ç—Ä–æ–∫–∞ 46-96

---

## üîß –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã

### Product::calculateVolume()
```php
// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—ä–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–æ—Ä–º—É–ª—ã –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —Ç–æ–≤–∞—Ä–∞
$volume = $product->calculateVolume();
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç float –∏–ª–∏ null
```

**–õ–æ–∫–∞—Ü–∏—è:** Product.php, —Å—Ç—Ä–æ–∫–∞ 336-380

### Product::updateCalculatedVolume()
```php
// –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±—ä–µ–º
$product->updateCalculatedVolume();
// –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
```

**–õ–æ–∫–∞—Ü–∏—è:** Product.php, —Å—Ç—Ä–æ–∫–∞ 385-390

### ProductTemplate::testFormula(array $values)
```php
// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º—É–ª—É –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
$result = $template->testFormula([
    'length' => 10,
    'width' => 5,
    'height' => 2
]);
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ['success' => true/false, 'error' => '...', 'result' => number]
```

**–õ–æ–∫–∞—Ü–∏—è:** ProductTemplate.php, —Å—Ç—Ä–æ–∫–∞ 68-140

---

## üßÆ –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞

**ProductTemplate::testFormula()** —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:

1. **–ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—É–ª—ã**
   ```php
   // Formula: "length * width * height"
   // –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: ['length', 'width', 'height']
   ```

2. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã**
   ```php
   if (!isset($values['length']) || !isset($values['width']) || ...) {
       return ['success' => false, 'error' => 'Missing variables'];
   }
   ```

3. **–ó–∞–º–µ–Ω—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è**
   ```php
   // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: "length * width * height"
   // –°—Ç–∞–Ω–æ–≤–∏—Ç—Å—è: "10 * 5 * 2"
   ```

4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ –≤—ã—á–∏—Å–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –≤—ã—Ä–∞–∂–µ–Ω–∏–π
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã: +, -, *, /, —Å–∫–æ–±–∫–∏
   - –°–æ–±–ª—é–¥–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üìä –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è calculated_volume

1. **StockResource** - —Ç–∞–±–ª–∏—Ü–∞ –û—Å—Ç–∞—Ç–∫–∏ –≤—ã–≤–æ–¥–∏—Ç –∫–∞–∫ "–û–±—ä–µ–º (–∑–∞ –µ–¥.)"
2. **–†–∞—Å—á–µ—Ç total_volume** - —Å—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω—ã–π –æ–±—ä–µ–º
3. **–û—Å—Ç–∞—Ç–æ–∫ –û–±—ä–µ–º (–º¬≥)** - –æ–±—â–∏–π –æ–±—ä–µ–º —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ
4. **API** - StockController –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–∏—Ö –æ–±—ä–µ–º–æ–≤
5. **ProductInTransit** - –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ø—É—Ç–∏

---

## ‚úÖ –ú–µ—Ö–∞–Ω–∏–∑–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ù–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏ (Product.php)
```php
public function setCalculatedVolumeAttribute($value)
{
    $maxValue = 999999999.9999; // decimal(15,4)
    
    if ($value > $maxValue) {
        Log::warning('Volume exceeds maximum');
        $this->attributes['calculated_volume'] = null;
        return;
    }
    
    $this->attributes['calculated_volume'] = $value;
}
```

### –ù–∞ —É—Ä–æ–≤–Ω–µ —Ñ–æ—Ä–º—ã (ProductResource.php)
```php
if ($result > 999999999.9999) {
    $set('calculated_volume', '–û–±—ä–µ–º –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ');
}
```

---

## üîÑ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∂–∏–∑–Ω–∏

```
1. –í–´ –≤—ã–±–∏—Ä–∞–µ—Ç–µ —à–∞–±–ª–æ–Ω
   ‚Üì
2. FILAMENT –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
   ‚Üì
3. –í–´ –≤–≤–æ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è
   ‚Üì
4. JAVASCRIPT –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (live)
   ‚Üì
5. LARAVEL –≤—ã—á–∏—Å–ª—è–µ—Ç calculated_volume
   ‚Üì
6. FILAMENT –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   ‚Üì
7. –í–´ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ —Ñ–æ—Ä–º—É
   ‚Üì
8. –ë–ê–ó–ê –î–ê–ù–ù–´–• —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç calculated_volume –∏ attributes
```

---

