# Экспорт приемок товара в Excel

## Описание

В раздел "Поступление товара" (Приемка) добавлена функциональность экспорта всех данных таблицы в файл Excel с указанием периода.

## Функциональность

### Основные возможности:
- ✅ Выбор периода экспорта (от даты и до даты)
- ✅ Экспорт всех данных таблицы в CSV формате (совместим с Excel)
- ✅ Учет прав доступа пользователя
- ✅ Автоматическое форматирование имени файла с датами
- ✅ Поддержка русского языка
- ✅ Полная информация о каждой приемке

## Где находится

**Путь в интерфейсе:** Приемка → Экспорт в Excel

**Кнопка:** "Экспорт в Excel" в верхней части списка приемок

## Какие данные выгружаются

Файл содержит следующие колонки:

1. **Наименование** - название товара
2. **Склад** - склад назначения
3. **Производитель** - производитель товара
4. **Шаблон** - шаблон товара
5. **Количество** - количество единиц
6. **Объем** - рассчитанный объем товара
7. **Дата отгрузки** - дата отправки
8. **Ожидаемая дата** - ожидаемая дата прибытия
9. **Статус** - статус приемки
10. **Сотрудник** - имя сотрудника, создавшего запись
11. **Дата создания** - дата и время создания записи

## Как использовать

### Шаг 1: Перейти в раздел приемок
Откройте раздел "Приемка товара" из главного меню.

### Шаг 2: Нажать кнопку "Экспорт в Excel"
В верхней части списка нажмите кнопку "Экспорт в Excel" (значок со стрелкой вниз).

### Шаг 3: Выбрать период
Откроется страница с форме. Заполните:
- **Дата начала** - начало периода (по умолчанию первый день текущего месяца)
- **Дата окончания** - конец периода (по умолчанию сегодня)

### Шаг 4: Экспортировать
Нажмите кнопку "Экспортировать в Excel" и файл автоматически загрузится.

## Особенности

### Форматирование файла
- **Формат:** CSV с разделителем (;) для совместимости с Excel
- **Кодировка:** UTF-8 с BOM для корректного отображения в Excel
- **Имя файла:** `Приемки_01.01.2025_-_31.01.2025.csv`

### Права доступа
- **Администраторы** видят все приемки
- **Операторы** видят приемки своего склада
- **Работники склада** видят приемки своего склада

### Данные в файле
- Включаются только приемки в статусе "Для приемки"
- Данные сортируются по дате создания (новые вверху)
- Если данные отсутствуют, показывается "—"

## Примеры использования

### Экспорт приемок за месяц
1. Откройте раздел "Приемка товара"
2. Нажмите "Экспорт в Excel"
3. Выберите даты с 1 по 30 января 2025
4. Нажмите "Экспортировать в Excel"
5. Файл `Приемки_01.01.2025_-_30.01.2025.csv` загрузится на компьютер

### Экспорт приемок за определенный период
1. Выберите произвольные даты
2. Экспорт содержит все приемки, созданные в этом периоде

## Открытие в Excel

### Способ 1: Прямое открытие
1. Скачайте файл
2. Откройте его двойным кликом
3. Excel автоматически предложит установить разделители

### Способ 2: Импорт в Excel
1. Откройте Excel
2. File → Open → выберите файл
3. В диалоге импорта выберите разделитель ";"

## Технические детали

### Класс ExportReceipts
**Файл:** `app/Filament/Resources/ReceiptResource/Pages/ExportReceipts.php`

Функции:
- `mount()` - инициализация с датами (текущий месяц по умолчанию)
- `form()` - форма с выбором периода
- `export()` - основной метод экспорта
- `generateExcel()` - генерация CSV файла

### Blade шаблон
**Файл:** `resources/views/filament/resources/receipt-resource/pages/export-receipts.blade.php`

Содержит:
- Форму для выбора дат
- Кнопки "Экспортировать" и "Отмена"
- Информационный блок о функциональности

## Маршруты

**Маршрут экспорта:** `/admin/resources/receipts/export`

Зарегистрирован в `ReceiptResource::getPages()`:
```php
'export' => Pages\ExportReceipts::route('/export'),
```

## Обновленные файлы

1. **app/Filament/Resources/ReceiptResource/Pages/ExportReceipts.php** (новый)
   - Класс для экспорта

2. **app/Filament/Resources/ReceiptResource/Pages/ListReceipts.php**
   - Добавлена кнопка "Экспорт в Excel"

3. **app/Filament/Resources/ReceiptResource.php**
   - Зарегистрирована новая страница экспорта

4. **resources/views/filament/resources/receipt-resource/pages/export-receipts.blade.php** (новый)
   - Blade шаблон страницы экспорта

## Ограничения и замечания

- ✅ Файл выгружается в CSV формате (совместим с Excel, Google Sheets и т.д.)
- ✅ Поддерживаются русские и английские названия
- ✅ Работает со всеми браузерами
- ⚠️ Большие объемы данных (более 10,000 записей) могут быть обработаны с задержкой

## Поддержка

Если у вас возникли проблемы с экспортом:
1. Проверьте, что выбран корректный период
2. Убедитесь, что у вас есть доступ к приемкам
3. Попробуйте освежить страницу (F5)

## FAQ

**В: Почему файл открывается как текст?**
О: Это нормально. Нужно выбрать "Открыть с помощью Excel" или переименовать расширение на .xls.

**В: Можно ли экспортировать за неограниченный период?**
О: Да, система автоматически обработает любой период. Просто выберите нужные даты.

**В: Какие права нужны для экспорта?**
О: Те же, что и для просмотра списка приемок (admin, operator, warehouse_worker).

