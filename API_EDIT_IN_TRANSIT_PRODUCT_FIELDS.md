# API: Поля при редактировании товара в пути

## Endpoint
```
PUT /api/products/{id}
```

## Поля, которые отправляются при редактировании

| Поле | Тип | Описание | Обязательное | Примечание |
|------|-----|---------|-------------|-----------|
| `name` | string | Название товара | Нет | Max 255 символов |
| `description` | string | Описание товара | Нет | Может быть null |
| `attributes` | array | Атрибуты товара (размеры, параметры) | Нет | Массив ключ-значение |
| `quantity` | numeric | Количество товара | Нет | Min 0, поддерживает запятую как разделитель (1,5 → 1.5) |
| `calculated_volume` | numeric | Рассчитанный объем | Нет | Min 0, если не передан - пересчитывается автоматически |
| `transport_number` | string | Номер транспортного средства | Нет | Max 255 символов, например: "А123БВ77" |
| `producer` | string | Название производителя (текст) | Нет | Max 255 символов, **устаревшее**, используйте `producer_id` |
| `producer_id` | integer | ID производителя | Нет | Должен существовать в таблице producers |
| `arrival_date` | date | Дата прибытия | Нет | Формат: YYYY-MM-DD |
| `is_active` | boolean | Активен ли товар | Нет | true/false |
| `notes` | string | Заметки | Нет | Max 1000 символов |
| `warehouse_id` | integer | ID склада | Нет | **Только для админов**, должен существовать в таблице warehouses |
| `shipping_location` | string | Место отправки товара | Нет | Max 255 символов, например: "Санкт-Петербург" |
| `shipping_date` | date | Дата отправки | Нет | Формат: YYYY-MM-DD |
| `expected_arrival_date` | date | Ожидаемая дата прибытия | Нет | Формат: YYYY-MM-DD |

## Пример запроса

```bash
curl -X PUT https://warehouse.expwood.ru/api/products/123 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Пиломатериалы: 95 x 200 x 6000: 2, Транспортная, Сосна",
    "quantity": 2.5,
    "transport_number": "А123БВ77",
    "producer_id": 1,
    "arrival_date": "2025-10-22",
    "shipping_location": "Санкт-Петербург",
    "shipping_date": "2025-10-20",
    "expected_arrival_date": "2025-10-25",
    "notes": "Товар в пути из Санкт-Петербурга",
    "is_active": true
  }'
```

## Поля товара в пути

**Все указанные выше поля доступны как при создании, так и при редактировании товара в пути.**

Для создания товара в пути используется поле `status` со значением `"in_transit"`.

## Автоматические пересчеты

При редактировании товара:
- Если изменены `attributes` или `quantity` И не передан `calculated_volume` → объем **пересчитывается автоматически**
- Если передан `calculated_volume` → используется переданное значение, пересчет не выполняется

## Права доступа

- **Админ**: может редактировать любой товар, включая изменение склада
- **Обычный пользователь**: может редактировать только товары своего склада (warehouse_id должен совпадать)

## Проверки при обновлении

1. Проверяется право доступа пользователя
2. Валидация всех полей согласно правилам выше
3. Нормализация количества (заменяет запятую на точку)
4. Нормализация атрибутов для консистентности
5. Пересчет объема при необходимости

## Response

```json
{
  "message": "Товар обновлен",
  "product": {
    "id": 123,
    "name": "Пиломатериалы: 95 x 200 x 6000: 2, Транспортная, Сосна",
    "description": null,
    "product_template_id": 1,
    "warehouse_id": 1,
    "quantity": 2.5,
    "status": "in_transit",
    "producer_id": 1,
    "transport_number": "А123БВ77",
    "arrival_date": "2025-10-22",
    "is_active": true,
    "notes": "Товар в пути из Санкт-Петербурга",
    "calculated_volume": 2850,
    "created_at": "2025-10-21T10:15:32.000000Z",
    "updated_at": "2025-10-22T14:30:45.000000Z",
    "template": { ... },
    "warehouse": { ... },
    "creator": { ... }
  }
}
```

## Ошибки

| Код | Сообщение | Причина |
|-----|-----------|---------|
| 403 | "Доступ запрещен" | Пользователь не имеет прав на редактирование товара этого склада |
| 404 | Not Found | Товар с указанным ID не найден |
| 422 | Validation Error | Ошибка валидации данных |

