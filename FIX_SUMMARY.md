# üéØ –ö—Ä–∞—Ç–∫–∏–π Summary: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –≤ API Stocks

## ‚ùì –í —á–µ–º –±—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞?

–ó–∞–ø—Ä–æ—Å –∫ API –æ—Ç–¥–∞–≤–∞–ª **–í–°–ï —Ç–æ–≤–∞—Ä—ã** –≤–º–µ—Å—Ç–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö:

```bash
GET /api/stocks/by-producer/1?search=–¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è
# ‚ùå –ë–´–õ: 4 —Ç–æ–≤–∞—Ä–∞ (–í–°–ï —Ç–æ–≤–∞—Ä—ã)
# ‚úÖ –°–¢–ê–õ–û: 1 —Ç–æ–≤–∞—Ä (–û–∫–Ω–∞ –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–µ)
```

## üîç –ö–∞–∫ –º—ã —ç—Ç–æ –Ω–∞—à–ª–∏?

1. –ó–∞–ø—Ä–æ—Å–∏–ª–∏ —Ç–æ–≤–∞—Ä—ã –ë–ï–ó —Ñ–∏–ª—å—Ç—Ä–∞ ‚Üí –≤–µ—Ä–Ω—É–ª–æ—Å—å 1 —Ç–æ–≤–∞—Ä (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 4)
2. –ó–∞–ø—Ä–æ—Å–∏–ª–∏ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º ‚Üí –≤–µ—Ä–Ω—É–ª–æ—Å—å 0 —Ç–æ–≤–∞—Ä–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 1)
3. –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ SQL ‚Üí –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É —Å GROUP BY

## üí° –í —á–µ–º –±—ã–ª–∞ –æ—à–∏–±–∫–∞?

**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–ª–∞ –í–°–ï —Ç–æ–≤–∞—Ä—ã –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É:**

```sql
-- –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
SELECT MIN(name), product_template_id, warehouse_id, producer_id
FROM products
GROUP BY product_template_id, warehouse_id, producer_id
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 —Å—Ç—Ä–æ–∫–∞ (–≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å–ª–∏–ø–∞—é—Ç—Å—è –≤ –æ–¥–Ω—É!)

-- –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
SELECT name, product_template_id, warehouse_id, producer_id
FROM products
GROUP BY name, product_template_id, warehouse_id, producer_id
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 4 —Å—Ç—Ä–æ–∫–∏ (–∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –æ—Ç–¥–µ–ª—å–Ω–æ!)
```

## ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–∏?

**–§–∞–π–ª:** `app/Http/Controllers/Api/StockController.php`

### 1Ô∏è‚É£ –ú–µ—Ç–æ–¥—ã, –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º:
- `showProducer()` - GET `/api/stocks/by-producer/{id}`
- `showWarehouse()` - GET `/api/stocks/by-warehouse/{id}`
- `showCompany()` - GET `/api/stocks/by-company/{id}`

### 2Ô∏è‚É£ –¢—Ä–∏ –∫–ª—é—á–µ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```diff
- SELECT MIN(name) as name  ‚Üí  SELECT name
- GROUP BY ..., product_template_id  ‚Üí  GROUP BY ..., name, product_template_id
- HAVING MIN(name) LIKE  ‚Üí  WHERE name LIKE
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ tinker - —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã - 5 —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤  
‚úÖ –ö–æ–¥ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω - Pint ‚úì  

## üì¶ Git –∫–æ–º–º–∏—Ç—ã

```
51ea325 - Add documentation and report for search filter fix
0112783 - Fix search filter for stocks by producer/warehouse/company - add name to GROUP BY
```

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. ‚úÖ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –±–æ–µ–≤–æ–π —Å–µ—Ä–≤–µ—Ä:
```bash
cd /var/www/sklad
git pull origin main
php artisan config:cache
```

2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Postman/API:
```
GET /api/stocks/by-producer/1?search=–¥–µ—Ä–µ–≤—è–Ω
GET /api/stocks/by-warehouse/2?search=–¥–æ—Å–∫–∞
GET /api/stocks/by-company/3?search=–ª–∞–º–∏–Ω–∞—Ç
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏

- **–ó–∞—Ç—Ä–∞—á–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–∏:** ~1 —á–∞—Å –∞–Ω–∞–ª–∏–∑–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 2 –æ—Å–Ω–æ–≤–Ω—ã—Ö + 2 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–æ:** 9 —Å—Ç—Ä–æ–∫ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
- **–¢–µ—Å—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 5 —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 3 —Ñ–∞–π–ª–∞

## üéì –£—Ä–æ–∫ –Ω–∞ –±—É–¥—É—â–µ–µ

–ö–æ–≥–¥–∞ –≤ WHERE –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–ª–µ (`MIN()`, `MAX()`, `SUM()`):
- ‚ùå –ù–µ–ª—å–∑—è: `WHERE MIN(name) LIKE ...`
- ‚úÖ –ù—É–∂–Ω–æ: `HAVING MIN(name) LIKE ...`

–ù–æ **–ª—É—á—à–µ** –≤–æ–æ–±—â–µ –Ω–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å:
- ‚úÖ –ü—Ä–æ—Å—Ç–æ: `SELECT name ... WHERE name LIKE ...`

---

**–î–∞—Ç–∞:** 24 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Æ
