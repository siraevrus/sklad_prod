# Реализация функциональности добавления нескольких товаров

## Обзор изменений

Добавлена возможность добавления нескольких товаров в формы `ReceiptResource` и `ProductInTransitResource` с использованием компонента `Repeater` от Filament.

## Измененные файлы

### 1. ReceiptResource.php
- Добавлен компонент `Repeater` для списка товаров
- Заменена секция "Информация о товаре" на "Товары"
- Добавлено поле `shipment_number` для группировки товаров
- Добавлена логика расчета объема для каждого товара
- Добавлена поддержка динамических полей характеристик

### 2. ProductInTransitResource.php
- Добавлен компонент `Repeater` для списка товаров
- Заменена секция "Товар" на "Товары"
- Сохранена вся существующая функциональность
- Добавлена поддержка нескольких товаров в одной поставке

### 3. CreateReceipt.php
- Обновлена логика создания записей для обработки нескольких товаров
- Первый товар создается как основная запись
- Дополнительные товары создаются как отдельные записи
- Все товары наследуют общие параметры поставки

### 4. CreateProductInTransit.php
- Обновлена логика создания записей для обработки нескольких товаров
- Аналогично CreateReceipt, но для товаров в пути
- Сохранена логика расчета объема и формирования наименований

### 5. ProductAttributeFactory.php
- Создана фабрика для тестирования атрибутов товаров
- Поддержка различных типов атрибутов (number, text, select)
- Состояния для обязательных/необязательных атрибутов

### 6. MultipleProductsTest.php
- Создан тест для проверки функциональности
- Тестирует создание приемки и товаров в пути с несколькими товарами
- Проверяет корректность структуры данных

## Функциональность

### Возможности
- Добавление от 1 до 50 товаров в одну поставку
- Автоматический расчет объема для каждого товара
- Динамические поля характеристик на основе шаблона
- Автоматическое формирование наименований товаров
- Группировка товаров по номеру поставки
- Переупорядочивание товаров в списке
- Сворачивание/разворачивание списка товаров

### Ограничения
- Минимум 1 товар в поставке
- Максимум 50 товаров в поставке
- Все товары должны иметь одинаковые общие параметры (склад, место отгрузки, даты)

## Использование

### В ReceiptResource
1. Заполните основную информацию о поставке
2. Добавьте товары через кнопку "Добавить товар"
3. Для каждого товара выберите шаблон и заполните характеристики
4. Количество товаров автоматически рассчитывается
5. Сохраните приемку

### В ProductInTransitResource
1. Заполните основную информацию о поставке
2. Добавьте товары через кнопку "Добавить товар"
3. Для каждого товара выберите шаблон и заполните характеристики
4. Количество товаров автоматически рассчитывается
5. Сохраните товары в пути

## Технические детали

### Структура данных
- Основная информация о поставке хранится в первой записи
- Каждый товар создается как отдельная запись в таблице `product_in_transit`
- Все товары связаны общим номером поставки (`shipment_number`)
- Характеристики товаров хранятся в JSON-поле `attributes`

### Логика расчета
- Объем рассчитывается для каждого товара отдельно
- Используется формула из шаблона товара
- Характеристики передаются в формулу вместе с количеством
- Результат сохраняется в поле `calculated_volume`

### Валидация
- Обязательные поля: шаблон товара, количество, склад, место отгрузки
- Проверка корректности характеристик товара
- Валидация дат и числовых значений
