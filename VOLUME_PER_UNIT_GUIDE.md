# üìä –ù–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ volume_per_unit - –û–±—ä—ë–º –∑–∞ –µ–¥–∏–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞

## üéØ –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ **`volume_per_unit`** –≤ —Ç–∞–±–ª–∏—Ü—É **`products`** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—ä—ë–º–∞ –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞.

---

## üìã –§–æ—Ä–º—É–ª–∞

```
volume_per_unit = calculated_volume / quantity

–ì–¥–µ:
  calculated_volume = –í–ï–°–¨ –æ–±—ä—ë–º –ø–∞—Ä—Ç–∏–∏ —Ç–æ–≤–∞—Ä–∞ (–º¬≥)
  quantity = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü –≤ –ø–∞—Ä—Ç–∏–∏
  volume_per_unit = –æ–±—ä–µ–º –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã (–º¬≥)
```

## üìä –ü—Ä–∏–º–µ—Ä

```
calculated_volume: 5.0 –º¬≥  (–≤–µ—Å—å –æ–±—ä—ë–º –ø–∞—Ä—Ç–∏–∏)
quantity: 100              (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü)

volume_per_unit = 5.0 / 100 = 0.05 –º¬≥ (–æ–±—ä—ë–º –∑–∞ 1 –µ–¥–∏–Ω–∏—Ü—É)
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|----------|----------|
| **calculated_volume** | DECIMAL(8,4) | 5.0000 | –í–ï–°–¨ –æ–±—ä—ë–º –ø–∞—Ä—Ç–∏–∏ —Ç–æ–≤–∞—Ä–∞ |
| **quantity** | INT | 100 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü –≤ –ø–∞—Ä—Ç–∏–∏ |
| **volume_per_unit** | DECIMAL(8,4) | 0.0500 | –û–±—ä—ë–º –∑–∞ 1 –µ–¥–∏–Ω–∏—Ü—É (—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) |

---

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç

### 1. **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ (CreateProduct)**

–ö–æ–≥–¥–∞ –≤—ã —Å–æ–∑–¥–∞—ë—Ç–µ —Ç–æ–≤–∞—Ä –≤ Filament:

```
1. –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç calculated_volume
2. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ boot() –º–µ—Ç–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –ë–µ—Ä—ë—Ç calculated_volume –∏ quantity
   - –í—ã—á–∏—Å–ª—è–µ—Ç: volume_per_unit = calculated_volume / quantity
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–∞–±–ª–∏—Ü—É
```

### 2. **–ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ (EditProduct)**

–ö–æ–≥–¥–∞ –≤—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç–µ —Ç–æ–≤–∞—Ä:

```
1. –ò–∑–º–µ–Ω—è–µ—Ç—Å—è quantity –∏–ª–∏ calculated_volume
2. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ boot() –º–µ—Ç–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç volume_per_unit
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ
```

### 3. **–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –≤ –ø—É—Ç–∏ (ProductInTransit)**

–ö–æ–≥–¥–∞ —Ç–æ–≤–∞—Ä —Å–æ–∑–¥–∞—ë—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ø—É—Ç–∏:

```
1. System —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—åProductInTransit
2. Boot –º–µ—Ç–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç volume_per_unit
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É product_in_transit
```

---

## üíæ –ì–¥–µ —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### –í —Ç–∞–±–ª–∏—Ü–µ products:

```sql
SELECT 
  id,
  name,
  quantity,
  calculated_volume,        -- –í–ï–°–¨ –æ–±—ä—ë–º –ø–∞—Ä—Ç–∏–∏
  volume_per_unit,          -- –û–±—ä—ë–º –∑–∞ 1 –µ–¥–∏–Ω–∏—Ü—É (–ù–û–í–û–ï!)
FROM products;

-- –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
-- id | name | quantity | calculated_volume | volume_per_unit
-- 1  | –î–æ—Å–∫–∞| 100      | 5.0000            | 0.0500
```

### –í —Ç–∞–±–ª–∏—Ü–µ product_in_transit:

```sql
SELECT 
  id,
  name,
  quantity,
  calculated_volume,        -- –í–ï–°–¨ –æ–±—ä—ë–º –ø–∞—Ä—Ç–∏–∏
  volume_per_unit,          -- –û–±—ä—ë–º –∑–∞ 1 –µ–¥–∏–Ω–∏—Ü—É (–ù–û–í–û–ï!)
FROM product_in_transit;
```

---

## üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í CreateProduct –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏:

```
STEP 10: Final data before create
{
  "calculated_volume": 5.0,
  "volume_per_unit": 0.05,    ‚Üê –ù–û–í–û–ï!
  "quantity": 100,
  ...
}
```

### –í EditProduct –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏:

```
STEP 8: Final data before save
{
  "calculated_volume": 5.0,
  "volume_per_unit": 0.05,    ‚Üê –ù–û–í–û–ï!
  "quantity": 100,
  ...
}
```

---

## üõ†Ô∏è –ú–µ—Ç–æ–¥—ã –≤ Product –º–æ–¥–µ–ª–∏

### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:

```php
// –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–±—ä—ë–º –∑–∞ –æ–¥–Ω—É –µ–¥–∏–Ω–∏—Ü—É
$volumePerUnit = $product->calculateVolumePerUnit();
// –†–µ–∑—É–ª—å—Ç–∞—Ç: 0.05 –º¬≥

// –û–±–Ω–æ–≤–∏—Ç—å –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è: calculated_volume –∏ volume_per_unit
$product->updateCalculatedVolume();
// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±–∞ –ø–æ–ª—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
```

### Boot –º–µ—Ç–æ–¥ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç):

```php
protected static function boot(): void
{
    parent::boot();

    static::saving(function (Product $product) {
        if ($product->calculated_volume !== null && $product->quantity > 0) {
            $product->volume_per_unit = round($product->calculated_volume / $product->quantity, 4);
        } else {
            $product->volume_per_unit = null;
        }
    });
}
```

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:** –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ volume_per_unit –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

---

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—Å—á—ë—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä 1: –î–æ—Å–∫–∏

```
–¢–æ–≤–∞—Ä: –î–æ—Å–∫–∞
quantity = 100 –¥–æ—Å–æ–∫
calculated_volume = 5.0 –º¬≥ (–≤–µ—Å—å –æ–±—ä—ë–º –ø–∞—Ä—Ç–∏–∏)

volume_per_unit = 5.0 / 100 = 0.05 –º¬≥

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: –∫–∞–∂–¥–∞—è –¥–æ—Å–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 0.05 –º¬≥ –æ–±—ä—ë–º–∞
```

### –ü—Ä–∏–º–µ—Ä 2: –ë—Ä—É—Å—å—è

```
–¢–æ–≤–∞—Ä: –ë—Ä—É—Å
quantity = 50 —à—Ç
calculated_volume = 10.0 –º¬≥ (–≤–µ—Å—å –æ–±—ä—ë–º –ø–∞—Ä—Ç–∏–∏)

volume_per_unit = 10.0 / 50 = 0.2 –º¬≥

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: –∫–∞–∂–¥—ã–π –±—Ä—É—Å –∑–∞–Ω–∏–º–∞–µ—Ç 0.2 –º¬≥ –æ–±—ä—ë–º–∞
```

### –ü—Ä–∏–º–µ—Ä 3: NULL –∑–Ω–∞—á–µ–Ω–∏–µ

```
–ï—Å–ª–∏ calculated_volume = NULL –∏–ª–∏ quantity = 0:
volume_per_unit = NULL

–ü–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–±—ä—ë–º –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç**
   - –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∑–∞–ø–æ–ª–Ω—è—Ç—å volume_per_unit
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

2. **–¢–æ—á–Ω–æ—Å—Ç—å**
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 4 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π (DECIMAL 8,4)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `round()` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

3. **NULL –∑–Ω–∞—á–µ–Ω–∏—è**
   - –ï—Å–ª–∏ calculated_volume = NULL, —Ç–æ volume_per_unit = NULL
   - –ï—Å–ª–∏ quantity ‚â§ 0, —Ç–æ volume_per_unit = NULL

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö**
   - –ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ NULL
   - –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—Ç–∞—Ä—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ volume_per_unit –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è

---

## üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è

### –§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:

```
database/migrations/2025_10_21_115021_add_volume_per_unit_to_products.php
```

### –ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç:

```php
$table->decimal('volume_per_unit', 8, 4)->nullable()
    ->after('calculated_volume')
    ->comment('–û–±—ä—ë–º –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ (calculated_volume / quantity)');
```

### –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞ –±–æ–µ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ:

```bash
ssh root@31.184.253.122
cd /var/www/warehouse
php artisan migrate --force
```

---

## üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **–ú–∏–≥—Ä–∞—Ü–∏—è**
   - `database/migrations/2025_10_21_115021_add_volume_per_unit_to_products.php`

2. **–ú–æ–¥–µ–ª–∏**
   - `app/Models/Product.php` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –∏ boot()
   - `app/Models/ProductInTransit.php` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ boot() –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞

3. **Filament Pages**
   - `app/Filament/Resources/ProductResource/Pages/CreateProduct.php` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - `app/Filament/Resources/ProductResource/Pages/EditProduct.php` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üîó –°–≤—è–∑–∞–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [[memory:10167262]] calculated_volume —Ö—Ä–∞–Ω–∏—Ç –í–ï–°–¨ –æ–±—ä—ë–º –ø–∞—Ä—Ç–∏–∏ —Ç–æ–≤–∞—Ä–∞
- CALCULATED_VOLUME_CORRECTION.md - –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É calculated_volume –∏ volume_per_unit

---

**–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:** October 21, 2025  
**Commit:** 95b9dac feat: Add volume_per_unit column and automatic calculation  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é

