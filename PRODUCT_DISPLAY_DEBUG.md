# Диагностика проблемы с отображением товаров

## Проблема
Товар сохраняется, но не отображается в `/admin/products`

## Возможные причины и решения

### 1. Проверка роли пользователя
```php
// В tinker или через логи
$user = Auth::user();
echo $user->role->value; // Должно быть 'admin' или 'operator'
```

### 2. Проверка связей товара
```php
// Проверяем, что товар создался с правильными связями
$product = Product::latest()->first();
echo $product->warehouse_id; // Должно быть не null
echo $product->product_template_id; // Должно быть не null
echo $product->created_by; // Должно быть не null
```

### 3. Проверка фильтрации по компании
```php
// Проверяем, что склад принадлежит компании пользователя
$user = Auth::user();
$warehouse = Warehouse::find($product->warehouse_id);
echo $warehouse->company_id; // Должно совпадать с $user->company_id
```

### 4. Проверка прав доступа
```php
// Проверяем, может ли пользователь видеть товары
$canView = ProductResource::canViewAny();
echo $canView ? 'true' : 'false'; // Должно быть true
```

### 5. Проверка запроса товаров
```php
// Проверяем, что запрос возвращает товары
$query = ProductResource::getEloquentQuery();
$products = $query->get();
echo $products->count(); // Должно быть больше 0
```

## Решение

### Если пользователь не имеет правильной роли:
1. Обновите роль пользователя в базе данных
2. Убедитесь, что пользователь имеет роль 'admin' или 'operator'

### Если товар не связан с правильным складом:
1. При создании товара убедитесь, что выбран правильный склад
2. Склад должен принадлежать компании пользователя

### Если есть проблема с фильтрацией:
1. Проверьте, что товар создается с правильным `warehouse_id`
2. Убедитесь, что склад принадлежит компании пользователя

### Если проблема с правами доступа:
1. Проверьте, что пользователь аутентифицирован
2. Убедитесь, что пользователь имеет правильную роль

## Команды для диагностики

```bash
# Проверка товаров в базе
php artisan tinker
>>> Product::count()
>>> Product::latest()->first()

# Проверка пользователя
>>> Auth::user()->role->value
>>> Auth::user()->company_id

# Проверка складов
>>> Warehouse::where('company_id', Auth::user()->company_id)->get()
``` 